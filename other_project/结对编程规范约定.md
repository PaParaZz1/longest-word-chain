# 结对编程规范约定

## Git使用

项目分为以下几个branch：

master：主分支，稳定版本，不能直接修改，一个阶段结束后，将dev分支merge到master分支中。

dev：开发分支，经常commit，每次push到远端仓库前先pull下远端的仓库，merge消除冲突后再push。

## 接口约定

待定

## 代码风格约定

学习Google开源项目风格指南，适当修改部分要求以符合两人的习惯。使用ReShaper插件规范风格。

### 1.项目整体

- 主要修改头文件、源文件两个文件夹。头文件文件夹存放.h文件，源文件文件夹存放.cpp文件。

### 2.头文件

#### 2.1  Define保护

为保证唯一性，所有头文件使用`#define` `#ifndef`来防止头文件被多重包含。

#### 2.2  #include顺序

如`dir/foo.cpp`的主要作用是实现 `dir2/foo2.h` 的功能， `foo.cpp` 中包含头文件的次序如下:

> 1. `dir2/foo2.h`
> 2. C 系统文件
> 3. C++ 系统文件
> 4. 其他库的 `.h` 文件
> 5. 本项目内 `.h` 文件

两类之间尽量空一行，同一类内部尽量使用字母顺序排序，例如：

```c++
#include "foo/public/fooserver.h"

#include <sys/types.h>
#include <unistd.h>

#include <hash_map>
#include <vector>

#include "base/basictypes.h"
#include "base/commandlineflags.h"
#include "foo/public/bar.h"
```

### 3.作用域

#### 3.1  局部变量

尽可能将局部变量置于最小作用域内， 并在变量声明时进行初始化，这使得代码浏览者更容易定位变量声明的位置， 了解变量的类型和初始值。例如：

```C++
int i;
i = f(); // 坏——初始化和声明分离
```

```C++
int j = g(); // 好——初始化时声明
```

```C++
vector<int> v;
v.push_back(1); // 用花括号初始化更好
v.push_back(2);
```

```C++
vector<int> v = {1， 2}; // 好——v 一开始就初始化
```

属于 `if`， `while` 和 `for` 语句中的变量也类似，这样子这些变量的作用域就被限制在这些语句中了，例如：

```C++
while (const char* p = strchr(str， '/')){
    str = p + 1;
}
```

**例外：**若变量是一个对象，则在 `while` 和 `for` 语句外声明，因为内部声明会导致效率极大地降低。

```C++
Foo f;                      // 构造函数和析构函数只调用 1 次
for (int i = 0; i < 1000000; ++i) {
    f.DoSomething(i);
}
```

### 4.类

#### 4.1  结构体 VS 类

仅当只有数据成员时使用 `struct`, 其它一概使用 `class`。

#### 4.2  声明顺序

类定义一般应以 `public:` 开始, 后跟 `protected:`, 最后是 `private:`。

在各个部分中, 建议将类似的声明放在一起, 并且建议以如下的顺序: 类型 (包括 `typedef`, `using` 和嵌套的结构体与类), 常量, 工厂函数, 构造函数, 赋值运算符, 析构函数, 其它函数, 数据成员。

### 5.函数

#### 5.1  参数顺序

函数的参数顺序为: 输入参数在先, 后跟输出参数。

**（其实我觉得这一点不一定非要遵守，因为有时候为了和其他函数保持风格统一，可能顺序必须得换一下，需要讨论一下）**

### 6.命名约定

#### 6.1  通用命名规则

函数命名, 变量命名, 文件命名要有描述性; 少用缩写。尽可能使用描述性的命名, 别心疼空间, 毕竟相比之下让代码易于新读者理解更重要。不要用只有项目开发者能理解的缩写, 也不要通过砍掉几个字母来缩写单词。以下复制的Google规范原文：

```
int price_count_reader;    // 无缩写
int num_errors;            // "num" 是一个常见的写法
int num_dns_connections;   // 人人都知道 "DNS" 是什么
int n;                     // 毫无意义.
int nerr;                  // 含糊不清的缩写.
int n_comp_conns;          // 含糊不清的缩写.
int wgc_connections;       // 只有贵团队知道是什么意思.
int pc_reader;             // "pc" 有太多可能的解释了.
int cstmr_id;              // 删减了若干字母.
```

注意, 一些特定的广为人知的缩写是允许的, 例如用 `i` 表示迭代变量和用 `T` 表示模板参数.

#### 6.2  文件命名

文件名要全部小写, 可以包含下划线 (`_`) 或连字符 (`-`), 依照项目的约定。 如果没有约定, 那么 “`_`” 更好。

（这个我们多半用不上，如果用得上的话，就用下滑线分割每一个单词。）

#### 6.3  类型命名

所有类型命名 —— 类, 结构体, 类型定义 (`typedef`), **枚举**, 类型模板参数 —— 均使用相同约定, 即以大写字母开始, 每个单词首字母均大写, 不包含下划线。例如:

```C++
// 类和结构体
class UrlTable { ...
class UrlTableTester { ...
struct UrlTableProperties { ...

// 类型定义
typedef hash_map<UrlTableProperties *, string> PropertiesMap;

// using 别名
using PropertiesMap = hash_map<UrlTableProperties *, string>;

// 枚举
enum UrlTableErrors { ...
```

#### 6.4  变量命名

变量 (包括函数参数) 和数据成员名一律小写, 单词之间用下划线连接。类的成员变量以下划线结尾, 但结构体的就不用, 如: `a_local_variable`, `a_struct_data_member`, `a_class_data_member_`。例如：

```C++
// 普通变量
string table_name;  // 好 - 用下划线.
string tablename;   // 好 - 全小写.

string tableName;  // 差 - 混合大小写
```

```C++
// 类
class TableInfo {
  ...
 private:
  string table_name_;  // 好 - 后加下划线.
  string tablename_;   // 好.
  static Pool<TableInfo>* pool_;  // 好.
};
```

```C++
// 结构体
struct UrlTableProperties {
  string name;
  int num_entries;
  static Pool<UrlTableProperties>* pool;
};
```

#### 6.5  常量

声明为 `constexpr` 或 `const` 的变量, 或在程序运行期间其值始终保持不变的, **命名时以 “k” 开头**, 大小写混合。例如:

```C++
const int kDaysInAWeek = 7;
```

#### 6.6  函数

一般来说, 函数名的每个单词首字母小写 (即 “驼峰变量名” 或 “帕斯卡变量名”), 没有下划线. 对于首字母缩写的单词, 更倾向于将它们视作一个单词进行首字母大写 (例如, 写作 `StartRpc()` 而非 `StartRPC()`).

```C++
addTableEntry()
deleteUrl()
openFileOrDie()
```

取值和设值函数的命名与变量一致。一般来说它们的名称与实际的成员变量对应, 但并不强制要求。例如 `int count()` 与 `void setCount(int count)`。前者为取值函数，后者为设值函数。

#### 6.7  宏

尽量少用，必须使用时使用全大写，单词之间使用下划线分割，例如：

```C++
#define ROUND(x) ...
#define PI_ROUNDED 3.0
```

#### 6.8  枚举

单独的枚举值应该优先采用常量的命名方式。枚举名 `UrlTableErrors`(以及 `AlternateUrlTableErrors`) 是类型, 所以要用大小写混合的方式。

```
enum UrlTableErrors {
    kOK = 0,
    kErrorOutOfMemory,
    kErrorMalformedInput,
};
enum AlternateUrlTableErrors {
    OK = 0,
    OUT_OF_MEMORY = 1,
    MALFORMED_INPUT = 2,
};
```

看规范说，以前的老代码是采用的宏命名方式，导致了很多冲突，所以建议尽量使用常量的命名方式，即以字母 k 开头的小驼峰。

### 7.注释

**个人想法：我们的注释都用中文写吧，万一因为写英文导致意思理解错了就尴尬了。。。**

巧妙或复杂的代码段前要加注释. 比如:

```C++
// Divide result by two, taking into account that x
// contains the carry from the add.
for (int i = 0; i < result->size(); i++) {
  x = (x << 8) + (*result)[i];
  (*result)[i] = x >> 1;
  x &= 1;
}
```

#### 7.1  类注释

每个类的定义都要附带一份注释, 描述类的功能和用法，除非它的功能相当明显。类注释应当为读者理解如何使用与何时使用类提供足够的信息, 同时应当提醒读者在正确使用此类时应当考虑的因素。

如果**类的声明和定义分开了**(例如分别放在了 `.h` 和 `.cpp` 文件中), 此时, 描述类**用法**的注释应当**和接口定义放在一起**, 描述类的**操作和实现**的注释应当**和实现放在一起**。

```C++
// Iterates over the contents of a GargantuanTable.
// Example:
//    GargantuanTableIterator* iter = table->NewIterator();
//    for (iter->Seek("foo"); !iter->done(); iter->Next()) {
//      process(iter->key(), iter->value());
//    }
//    delete iter;
class GargantuanTableIterator {
  ...
};
```

#### 7.2   函数注释

函数声明处的注释描述函数功能; 定义处的注释描述函数实现。只有在函数的功能简单而明显时才能省略这些注释(例如, 简单的取值和设值函数)。

函数声明处注释的内容**（这个是我根据Google的规范自己修改的一些，因为感觉他写的挺多用不上，可能我修改的也会有问题，可以讨论一下）**：

- 函数的输入（调用过程中不会被修改的参数）

- 函数的输出（调用过程中会被修改的参数）

- 函数会修改哪些外部变量（除了输出参数以外的）

- 函数的返回值含义

- 函数是否分配了必须由调用者释放的空间（我觉得没有就可以不用写）

#### 7.3  变量注释

（以下为“抄袭”Google规范的部分）

通常变量名本身足以很好说明变量用途。某些情况下, 也需要额外的注释说明。

**类数据成员**

每个类数据成员 (也叫实例变量或成员变量) 都应该用注释说明用途. 如果有非变量的参数(例如特殊值, 数据成员之间的关系, 生命周期等)不能够用类型与变量名明确表达, 则应当加上注释. 然而, 如果变量类型与变量名已经足以描述一个变量, 那么就不再需要加上注释.

特别地, 如果变量可以接受 `NULL` 或 `-1` 等警戒值, 须加以说明. 比如:

```C++
private:
 // Used to bounds-check table accesses. -1 means
 // that we don't yet know how many entries the table has.
 int num_total_entries_;
```

**全局变量**

和数据成员一样, 所有全局变量也要注释说明含义及用途。 比如:

```C++
// The total number of tests cases that we run through in this regression test.
const int kNumTestCases = 6;
```

### 8.其他

#### 8.1  默认初始化（即没有确定的初值时）

整数用 `0`, 实数用 `0.0`, 指针用 `nullptr` 或 `NULL`, 字符 (串) 用 `'\0'`。

#### 8.2  缩进

四个空格才是真理。

#### 8.3  空格和换行

我觉得这个影响不大，我们没必要统一，自己习惯就好233。我的习惯类似于下面：

```C++
#include <iostream>

using namespace std;

int main(){
    int a = 0, b = 1;
    if(a == b){
        return 0;
    } else{
        return 1;
    }
}
```